<div
  [id]="modalId"
  tabindex="-1"
  aria-hidden="true"
  class="hidden fixed inset-0 z-50 items-center justify-center w-full h-full overflow-y-auto overflow-x-hidden"
>
  <div class="relative w-full max-w-2xl p-4">
    <div
      class="relative bg-white dark:bg-gray-800 rounded-2xl shadow-xl sm:p-6 transition-all duration-300"
    >
      <!-- Header -->
      <div
        class="flex justify-between items-center pb-4 mb-6 border-b dark:border-gray-700"
      >
        <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
          Карточка пользователя
        </h3>
        <button
          type="button"
          class="text-gray-400 hover:text-gray-900 dark:hover:text-yellow-400 rounded-lg p-2 transition-colors"
          (click)="closeEvent.emit()"
        >
          <svg
            aria-hidden="true"
            class="w-6 h-6"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414
                 1.414L11.414 10l4.293 4.293a1 1 0
                 01-1.414 1.414L10 11.414l-4.293
                 4.293a1 1 0 01-1.414-1.414L8.586
                 10 4.293 5.707a1 1 0 010-1.414z"
              clip-rule="evenodd"
            ></path>
          </svg>
        </button>
      </div>

      <!-- Tabs -->
      <div class="flex border-b mb-6 text-sm font-medium">
        <button
          class="px-4 py-2 border-b-2 transition-colors"
          [ngClass]="{
            'border-yellow-400 text-yellow-500': activeTab === 'profile',
            'border-transparent text-gray-500 hover:text-yellow-400':
              activeTab !== 'profile',
          }"
          (click)="activeTab = 'profile'"
        >
          Профиль
        </button>
        <button
          class="px-4 py-2 border-b-2 transition-colors"
          [ngClass]="{
            'border-yellow-400 text-yellow-500': activeTab === 'security',
            'border-transparent text-gray-500 hover:text-yellow-400':
              activeTab !== 'security',
          }"
          (click)="activeTab = 'security'"
        >
          Безопасность
        </button>
      </div>

      @if (activeTab === "profile") {
        <!-- Profile form -->

        <div class="animate-fadeIn">
          <form [formGroup]="mainForm" class="space-y-4">
            <div class="grid gap-4 sm:grid-cols-2">
              <!-- Полное имя -->
              <div>
                <label
                  for="fullName"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-200"
                >
                  Полное имя
                </label>
                <input
                  readonly
                  id="fullName"
                  type="text"
                  formControlName="fullName"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                />
              </div>

              <!-- Email -->
              <div>
                <label
                  for="email"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-200"
                >
                  Email
                </label>
                <input
                  readonly
                  id="email"
                  type="text"
                  formControlName="email"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                />
              </div>

              <!-- Телефон -->
              <div>
                <label
                  for="phone"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-200"
                >
                  Телефон
                </label>
                <input
                  id="phone"
                  type="text"
                  formControlName="phone"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                />
              </div>

              <!-- Telegram -->
              <div>
                <label
                  for="telegrameChatId"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-200"
                >
                  Telegram ID
                </label>
                <input
                  id="telegrameChatId"
                  type="text"
                  formControlName="telegrameChatId"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                />
              </div>
            </div>

            <div class="flex justify-end mt-6">
              <button
                type="button"
                (click)="updateUser()"
                [disabled]="mainForm.invalid"
                [class.opacity-50]="mainForm.invalid"
                class="bg-yellow-400 text-gray-900 font-medium px-5 py-2.5 rounded-lg shadow hover:shadow-md transition-all"
              >
                Сохранить данные
              </button>
            </div>
          </form>
        </div>
      }
      @if (activeTab === "security") {
        <!-- Security form -->
        <div class="animate-fadeIn">
          <form [formGroup]="passwordForm" class="space-y-4">
            <div>
              <label
                for="currentPassword"
                class="block text-sm font-medium text-gray-700 dark:text-gray-200"
              >
                Старый пароль
              </label>
              <input
                id="currentPassword"
                type="password"
                formControlName="currentPassword"
                placeholder="••••••••"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
              />
            </div>

            <div>
              <label
                for="newPassword"
                class="block text-sm font-medium text-gray-700 dark:text-gray-200"
              >
                Новый пароль
              </label>
              <input
                id="newPassword"
                type="password"
                formControlName="newPassword"
                placeholder="••••••••"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
              />
            </div>

            <div>
              <label
                for="confirmPassword"
                class="block text-sm font-medium text-gray-700 dark:text-gray-200"
              >
                Повтор нового пароля
              </label>
              <input
                id="confirmPassword"
                type="password"
                formControlName="confirmPassword"
                placeholder="••••••••"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
              />
            </div>

            <div class="flex justify-end mt-6">
              <button
                type="button"
                (click)="changePassword()"
                [disabled]="passwordForm.invalid"
                [class.opacity-50]="passwordForm.invalid"
                class="bg-yellow-400 text-gray-900 font-medium px-5 py-2.5 rounded-lg shadow hover:shadow-md transition-all"
              >
                Сменить пароль
              </button>
            </div>
          </form>
        </div>
      }
      <!-- Error -->
      @if (errorString() !== "") {
        <div
          class="mt-4 p-3 text-sm text-red-700 rounded-lg bg-red-50 dark:bg-gray-700 dark:text-red-400"
        >
          {{ errorString() }}
        </div>
      }
    </div>
  </div>
</div>
